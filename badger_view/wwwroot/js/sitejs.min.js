function GetProductDetails(n,t,i){$(".loading").show();SelectedProductID=t;var r=t;$.ajax({url:"/vendor/products/"+n+"/"+r+"/"+i,dataType:"json",type:"GET",contentType:"application/json",processData:!0}).always(function(n){var s,f,e,i,o,t,h,r,u;if(data_vendor=n.vendor,s=n.productLineItemList,n=n.vendorProducts,f="",$("#po_id").val(CurrentPOID),$("#vendor_id").val(CurrentVendorId),$(".vendorSkuBox_disabled").remove(),$(".vendorSkuBox").remove(),n.length){for(t=0;t<n.length;t++)if($("#modaladdstylec #product_title").val(n[t].product_name),$("#modaladdstylec #product_unit_cost").val(n[t].product_cost),$("#modaladdstylec #product_color").val(n[t].vendor_color_name),$("#modaladdstylec #product_retail").val(n[t].product_retail),$("#modaladdstylec #product_color_code").val(n[t].vendor_color_code),$("#modaladdstylec #product_title_no").val(n[t].vendor_product_code),$("#modaladdstylec #StyleType").val($("#modaladdstylec #StyleType option[value="+n[t].product_type_id+"]").val()).change(),$("#modaladdstylec #StyleType").attr("disabled",""),$(".style_doc_section").empty(),e=n[t].product_vendor_image,e!=null?($(".style_doc_section").append("<img src="+window.location.origin+"/uploads/"+e+" width='50' />  <br>"),$(".style_doc_section").removeClass("d-none")):$(".style_doc_section").addClass("d-none"),f=n[t].sku_family,CreateProductLineItems(s,JSON.parse(n[t].skulist)),i=JSON.parse(n[t].productCategories),i!=null){for(o=[],t=0;t<i.length;t++)h=i[t],o.push(h.category_id);$("#StyleSubType").multiselect("select",o)}new_sku=f}else data_vendor[0].latest_sku?(r=data_vendor[0].vendor_code,u=parseInt(data_vendor[0].latest_sku),new_sku=r+u):(r=data_vendor[0].vendor_code,u=100,new_sku=r+u);$(".poSkuFamily").text(new_sku);$(".poVendor").text(data_vendor[0].vendor_code);$(".loading").hide();$("#modaladdstylec").modal({backdrop:"static",keyboard:!1});console.log(n)})}function CreateProductLineItems(n,t){var s,f,o,c,u,i,r,e,h;if(IsLineItemExists=!1,s=$("#po_input_fields_wrap"),$(".vendorSkuBox").remove(),$(".vendorSkuBox_disabled").remove(),$(".vendorSkuArea").show(),f="",o="",n==null||n.length==0){if($("#AddNewStyleButton").show(),window.sku_sizes)for(i=0;i<t.length;i++)if(t[i].sku!=null&&t[i].sku!=""){for(f="",r=0;r<sku_sizes.length;r++)e="",sku_sizes[r].attribute_id==t[i].attribute_id&&(e="selected"),f+=" <option value='"+sku_sizes[r].attribute_id+"'  "+e+">"+sku_sizes[r].attribute_display_name+"<\/option>";$(s).append('<div class="pb-2 vendorSkuBox form-row"> <div class="form-group col-md-3"><input type="text" class="form-control d-inline " name="csize['+u+']" value="'+t[i].vendor_size+'"  placeholder="Vendor Size" id="styleVendorSize" disabled  /><\/div><div class="form-group col-md-3"><select class="form-control d-inline" name="styleSize" id="styleSize" disabled >'+f+'<\/select><\/div> <div class="form-group col-md-3"><input type="text" class="form-control d-inline " id="styleSku" name="styleSku"  placeholder="Size" value="'+t[i].sku+'" style="text-transform: uppercase;"   disabled /><\/div> <div class="form-group col-md-3"> <input type="text" class="form-control d-inline " min="1"  placeholder="Qty"  id="styleSkuQty"   />  ');o=t[i].sku.split("-")[0]}}else{for(IsLineItemExists=!0,$("#AddNewStyleButton").hide(),c=[],u=0;u<n.length;u++){if(f="",window.sku_sizes)for(r=0;r<sku_sizes.length;r++)e="",sku_sizes[r].attribute_id==n[u].attribute_id&&(e="selected"),f+=" <option value='"+sku_sizes[r].attribute_id+"'  "+e+">"+sku_sizes[r].attribute_display_name+"<\/option>";o=n[u].sku.split("-")[0];h=n[u].sku.split("-")[1];c.push({sku:n[u].sku,attribute_id:n[u].attribute_id});$(s).append('<div class="pb-2 vendorSkuBox form-row" data-skunum="'+h+'"> <div class="form-group col-md-3"><input type="text" class="form-control d-inline" name="csize['+u+']" value = "'+n[u].vendor_size+'" placeholder="Vendor Size" id="styleVendorSize" disabled  /><\/div><div class="form-group col-md-3"><select class="form-control d-inline"  name="styleSize" id="styleSize" value = ""  disabled>'+f+'<\/select><\/div> <div class="form-group col-md-3"><input type="text" class="form-control d-inline " name="size['+u+']" placeholder="Size" id="styleSku" name="styleSku" value="'+n[u].sku+'"  style="text-transform: uppercase;"  disabled /><\/div> <div class="form-group col-md-3"> <input type="text" class="form-control d-inline required " name="cqty['+u+']" placeholder="Qty" data-originalQuantity="'+n[u].line_item_ordered_quantity+'" min="1" id="styleSkuQty" value="'+n[u].line_item_ordered_quantity+'"  />  ')}if(window.sku_sizes)for(i=0;i<t.length;i++)if($("input[value='"+t[i].sku+"']").val()==null&&t[i].sku!=null&&t[i].sku!=""){for(f="",r=0;r<sku_sizes.length;r++)e="",sku_sizes[r].attribute_id==t[i].attribute_id&&(e="selected"),f+=" <option value='"+sku_sizes[r].attribute_id+"'  "+e+">"+sku_sizes[r].attribute_display_name+"<\/option>";h=t[i].sku.split("-")[1];$(s).append('<div class="pb-2 vendorSkuBox form-row" data-skunum="'+h+'"> <div class="form-group col-md-3"><input type="text" class="form-control d-inline required " name="csize['+u+']" value="'+t[i].vendor_size+'"  placeholder="Vendor Size" id="styleVendorSize" disabled  /><\/div><div class="form-group col-md-3"><select class="form-control d-inline" name="styleSize" id="styleSize"  disabled>'+f+'<\/select><\/div> <div class="form-group col-md-3"><input type="text" class="form-control d-inline "  placeholder="Size" value="'+t[i].sku+'" style="text-transform: uppercase;" disabled name="styleSku" id="styleSku" /><\/div> <div class="form-group col-md-3"> <input type="text" class="form-control d-inline"  placeholder="Qty" min="1"  id="styleSkuQty"   />  ');o=t[i].sku.split("-")[0]}}Original_sku=new_sku;new_sku=o;$(".poSkuFamily").text(new_sku);$(".poAlertMsg").html("")}function GetCategories(){var n=$.Deferred();return data_Categories==null||data_Categories==0?$.ajax({url:"/categoryoption/GetCategories",type:"GET",contentType:"application/json",processData:!0}).always(function(t){var i,r;if(data_Categories=t,$("#modaladdstylec #StyleType option").remove(),$("#modaladdstylec #StyleType").append("<option id='-1' value=''>Choose...<\/option>"),i=data_Categories.filter(function(n){return n.category_type==0}),i.length)for(r=0;r<i.length;r++)$("#modaladdstylec #StyleType").append("<option value='"+i[r].category_id+"'>"+i[r].category_name+"<\/option >");n.resolve()}):n.resolve(),n.promise()}function GetSkuSizes(){var n=$.Deferred();return window.sku_sizes==null||window.sku_sizes==0?$.ajax({url:"/attributes/getskusizes",type:"GET",contentType:"application/json",processData:!0}).always(function(t){window.sku_sizes=t;n.resolve()}):n.resolve(),n.promise()}function AppendSkuTextBoxes(n,t){var r,u,f;if($("#po_input_fields_wrap").html(""),r="",t==2&&(r='<button type="button" class="btn btn-primary form-control " name="btstyleVendorSize" id="btstyleVendorSize" > Add Size <\/button>'),$(".vendorSkuArea #styleVendorSize").length==0){for(x=1;x<n;x++){if(u="",window.sku_sizes)for(i=0;i<sku_sizes.length;i++)f="",i==x-1&&(f="selected"),u+=" <option value='"+sku_sizes[i].attribute_id+"'  "+f+">"+sku_sizes[i].attribute_display_name+"<\/option>";$("#po_input_fields_wrap").append('<div class="pb-2 vendorSkuBox form-row"> <div class="form-group col-md-3"> '+r+' <input type="text" class="form-control required" name="styleVendorSize" id="styleVendorSize" placeholder="Vendor Size" /><\/div> <div class="form-group col-md-3"><select class="form-control d-inline  required" name="styleSize" id="styleSize">'+u+'<\/select><\/div> <div class="form-group col-md-3"><input type="text"  style="text-transform: uppercase;" class="form-control d-inline  required" name="styleSku" id="styleSku" placeholder="SKU" value = "" /><\/div> <div class="form-group col-md-3"><input type="number" class="form-control d-inline  required"  min="1" name="styleSkuQty" id="styleSkuQty" placeholder="Qty" /><\/div> <a href="#" class="remove_field">Remove<\/a> <\/div>')}t==2&&(CreateSKU($("#styleVendorSize")[0],!0),$("#po_input_fields_wrap .vendorSkuBox #styleVendorSize").each(function(){$(this).hide()}),$("#po_input_fields_wrap .vendorSkuBox #btstyleVendorSize").click(function(){$(this).next().show();$(this).hide();$(".add_field_button").show()}))}}function CreateSKU(n,t){var i=0,u,f,r;($(n).parent().parent().find("#styleSku").val()==""?i=$("#po_input_fields_wrap .vendorSkuBox #styleVendorSize").filter(function(){return this.value!=""}).length:(u=$($(n).parent().parent()[0].previousSibling).data("skunum"),i=u==null?0:parseInt(u)+1),t!=!1||(f=$($(n).parent().parent().find("#styleSku")).attr("disabled"),typeof f==typeof undefined||f===!1))&&($(n).val()==""&&t==!1?$(n).parent().parent().find("#styleSku").val(""):(i==0&&(i+=1),r=new_sku,t||(r+="-"+i),$(n).parent().parent().find("#styleSku").val(r),$(n).parent().parent().find("#styleSku").removeClass("errorFeild"),$(n).parent().parent().find(".errorMsg").remove(),$(n).parent().parent().data("skunum",i),isSkuDuplicate(r)&&(r=new_sku+"-"+(i+1),$(n).parent().parent().find("#styleSku").val(r))))}function isSkuDuplicate(n){var t=$("#po_input_fields_wrap .vendorSkuBox #styleSku").filter(function(){return this.value==n}).length;return t==1?!1:!0}function isTitleDuplicate(n){if(SelectedProductID!=null)return!1;var t=$("#ExistingProductSelect option").filter(function(){return $(this).val()==n}).length;return t?!0:!1}function general_search(){var n=$("#general_search");n.autocomplete({delay:0,source:function(n,t){var r={},i;r.search=n.term;console.log(r);i=[];$(".search_result_list").hide();n.term.length>3&&$.ajax({url:"/search/autosuggest/",dataType:"json",type:"post",data:JSON.stringify(r),contentType:"application/json",processData:!1}).always(function(n){console.log(n);n.barcodeList.length>0&&(i=i.concat(n.barcodeList));n.skuList.length>0&&(i=i.concat(n.skuList));n.vendorList.length>0&&(i=i.concat(n.vendorList));n.productList.length>0&&(i=i.concat(n.productList));n.purchaseOrdersList.length>0&&(i=i.concat(n.purchaseOrdersList));n.styleNumberList.length>0&&(i=i.concat(n.styleNumberList));t(i)})},select:function(){return!1},focus:function(){return!1}});n.data("ui-autocomplete")._renderItem=function(n,t){n.addClass("search_result_list");var i=$("<li>"),r=$('<img style="width:50px;padding-right:4px;">'),u=$('<div class="s_img">'),f=$('<div class="s_title">');return t.type=="vendor"?t.image!=undefined&&t.image!=null&&r.attr({src:"https://fashionpass.s3.us-west-1.amazonaws.com/badger_images/"+t.image}):(t.image!=undefined||t.image!=null)&&(t.image.indexOf("http")!=-1?r.attr({src:t.image}):r.attr({src:window.location.origin+"/uploads/"+t.image})),i.attr("data-value",t.label),t.type=="barcode"&&i.append('<a href="#barcode">'),t.type=="sku"&&i.append('<a href="#sku">'),t.type=="vendor"&&i.append('<a href="'+window.location.origin+"/Vendor/Single/"+t.value+'">'),(t.type=="product"||t.type=="stylenumber")&&i.append('<a href="'+window.location.origin+"/Product/EditAttributes/"+t.value+'">'),t.type=="purchase_orders"&&i.append('<a href="'+window.location.origin+"/PurchaseOrders/Single/"+t.value+'">'),t.image!=null&&t.image!=undefined?(u.append(r),f.append(t.label),i.find("a").addClass("li_search").append(u).append(f)):i.find("a").append(t.label),i.appendTo(n)}}var dropdownlist;$(document).on("click",".DeletefromPOButton",function(){$(".poAlertMsg").append('<div class="spinner-border text-info"><\/div>');SelectedProductID!=null?confirmationAlertInnerBox("Delete from PO","Are you sure that you want to delete this record?",function(n){var t=parseInt($("#newAddStyleForm #po_id").val()),i;n=="yes"?(i=SelectedProductID,$.ajax({url:location.origin+"/styles/deleteFromPO/"+i+"/"+t,dataType:"json",type:"get",processData:!1}).always(function(n){console.log(n);n==!0?($("#modaladdstylec").modal("hide"),alertBox("poAlertMsg","green","Product deleted successfully"),$("#collapse_"+t).hide(),$("#collapse_"+t).html("")):alertBox("poAlertMsg","red","Product delete failed because some product are already recieved")})):$(".text-info").hide()}):alertBox("poAlertMsg","red","Please select a product")});var Original_sku="",new_sku="",SelectedProductID,data_Categories,productSubCategoriesAction=[],IsLineItemExists=!1,CurrentVendorId,CurrentPOID;$(document).on("click",".AddNewStyleButton",function(){var n,e,f,s,h,t,u;$(".loading").show();var c=$(this).attr("data-action"),i=!1,a=$("#newAddStyleForm input");if($("#newAddStyleForm .errorFeild").length>0||emptyFeildValidation("newAddStyleForm")==!1)return $(".loading").hide(),!1;if($("#newAddStyleForm #product_title").val().length<4)return alertBox("poAlertMsg","red","Style name cannot be less than 4 characters.",5e3),$(".loading").hide(),!1;if(n={},selectedProject=$("#ExistingProductSelect option:selected"),SelectedProductID&&SelectedProductID>0&&(n.product_id=SelectedProductID,i=!0),n.po_id=CurrentPOID,n.vendor_id=CurrentVendorId,n.product_name=$("#newAddStyleForm #product_title").val(),n.vendor_color_name=$("#newAddStyleForm #product_color").val(),n.product_cost=$("#newAddStyleForm #product_unit_cost").val(),n.product_retail=$("#newAddStyleForm #product_retail").val(),n.product_name_no=$("#newAddStyleForm #product_title_no").val(),n.product_color_code=$("#newAddStyleForm #product_color_code").val(),n.product_type_id=$("#StyleType option:selected").val(),n.IsLineItemExists=IsLineItemExists,n.product_subtype_ids=productSubCategoriesAction,n.sku_family=new_sku,n.UpdateVendorType=!1,$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("vendorstyle")!=$("#StyleType").val()&&(n.UpdateVendorType=!0),n.vendor_style_sku=[],e=$("#StyleType").val()=="1"?new RegExp("^[a-zA-Z]+[0-9]{3}-{1}[0-9]+$"):new RegExp("^[a-zA-Z]+[0-9]{3}$"),f=!0,$("#po_input_fields_wrap .vendorSkuBox").each(function(){var t={},r=$(this).find("#styleVendorSize").val(),u=$(this).find("#styleSize").val(),i=$(this).find("#styleSku").val(),o=$(this).find("#styleSkuQty").val(),s=$($(this).find("#styleSku")).attr("disabled"),h=!1,c=0,l;if(h=typeof s!=typeof undefined&&s!==!1?!1:!0,IsLineItemExists&&(c=$(this).find("#styleSkuQty").data().originalquantity),t.style_vendor_size=r,t.style_size=u,t.style_sku=i,t.style_qty=o,t.IsNewSku=h,t.original_qty=c,l=i,e.test(l)==!1)return $($(this).find("#styleSku")).addClass("errorFeild"),n.vendor_style_sku=[],f=!1,!1;$($(this).find("#styleSku")).removeClass("errorFeild");r!=null&&u!=null&&i!=null&&o&&n.vendor_style_sku.push(t)}),!f){$(".loading").hide();return}if(n.vendor_style_sku.length==0){alertBox("poAlertMsg","red","Atleast one valid SKU is required.");$(".loading").hide();return}var r=$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("calculationvalues"),o=$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("total_quantity"),l=$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("total_styles");if(r==""||r==null){if(t=0,u=n.vendor_style_sku,$.each(u,function(n,i){var r=parseInt(i.style_qty);t=t+r}),t>o){alertBox("poAlertMsg","red","Total Quantity limit reached. Please increase total quantity in Purchase Order to proceed.",5e3);$(".loading").hide();return}}else{if(s=r.filter(function(n){return n.calculation_id==5}),i==!1&&(h=r.filter(function(n){return n.calculation_id==6}),h[0].value+1>l)){alertBox("poAlertMsg","red","Total Styles Count limit reached. Please increase total styles count in Purchase Order to proceed.",5e3);$(".loading").hide();return}if(t=s[0].value,u=n.vendor_style_sku,$.each(u,function(n,i){var r=parseInt(i.original_qty),u,f;(r==null||isNaN(r))&&(r=0);u=parseInt(i.style_qty);r!=u&&(r>u?(f=r-u,t=t-f):(f=u-r,t=t+f))}),t>o){alertBox("poAlertMsg","red","Total Quantity limit reached. Please increase total quantity in Purchase Order to proceed.",5e3);$(".loading").hide();return}}$.ajax({url:location.origin+"/styles/create",type:"post",contentType:"application/json",data:JSON.stringify(n),processData:!1}).always(function(t){var o,f,s,h,r,l,u,y,e;if(t=="0"){alertBox("poAlertMsg","red","Unable to create/update style.");$(".loading").hide();return}if(t=="-4"){alertBox("poAlertMsg","red","SKU already exists, please try to bump it by 1.");$(".loading").hide();return}if(t=="-3"){alertBox("poAlertMsg","red","Cannot reduce quantity of sku.");$(".loading").hide();return}if(t!="0"){if($("#StyleSubType").multiselect("clearSelection"),$(".style_doc_section").empty(),$(".vendorSkuBox").remove(),console.log("New style Added"),o=$("#newAddStyleForm #StyleImage")[0].files[0],o&&(f=new FormData,f.append("product_id",t),f.append("StyleImage",o),$.ajax({url:location.origin+"/styles/newdoc",type:"POST",data:f,processData:!1,contentType:!1}).always(function(n){console.log(n)})),i?alertBox("poAlertMsg","green","Style Updated successfully"):alertBox("poAlertMsg","green","New style inserted successfully"),c=="refreshValue"?($("#newAddStyleForm #po_id").val(CurrentPOID),$("#newAddStyleForm #vendor_id").val(CurrentVendorId),SelectedProductID=null,$("#modaladdstylec input,#modaladdstylec textarea, #modaladdstylec select").val("").removeClass("errorFeild")):(SelectedProductID=null,$("#collapse_"+CurrentPOID).html(""),$("#collapse_"+CurrentPOID).hide(),$("#modaladdstylec").modal("hide"),window.location.href.indexOf("PurchaseOrders/Single")>-1||$("a[data-poid="+CurrentPOID+"]").trigger("click")),i==!1&&(s=new_sku.match(/[a-z]+|[^a-z]+/gi),h=s[0]+(parseInt(s[1])+1),$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("skufamily",new_sku),$(".poSkuFamily").text(h),new_sku=h),u=$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("calculationvalues"),u==""||u==null)r=0,l=n.vendor_style_sku,$.each(l,function(n,t){var i=parseInt(t.style_qty);r=r+i}),u=[{value:1,calculation_id:6},{value:r,calculation_id:5}],$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("calculationvalues",u);else{var a=u.filter(function(n){return n.calculation_id==5}),v=u.filter(function(n){return n.calculation_id==6}),r=a[0].value,l=n.vendor_style_sku;$.each(l,function(n,t){var i=parseInt(t.original_qty),u=parseInt(t.style_qty),f;(i==null||isNaN(i))&&(i=0);i!=u&&(i>u?(f=i-u,r=r-f):(f=u-i,r=r+f))});a[0].value=r;i==!1&&(v[0].value+=1);y=[a[0],v[0]];$('button[data-poid="'+CurrentPOID+'"][id=AddItemButton][class="btn btn-light btn-sm"]').data("calculationvalues",y)}window.location.href.indexOf("PurchaseOrders/Single")>-1&&(e=window.location.href.split("Single/")[1],e!=undefined&&e!=""&&($(".loading").show(),getSinglePurchaseOrder(e)))}$(".loading").hide()})});$(document).ready(function(){var r=10,t=$("#po_input_fields_wrap"),u=$(".add_field_button"),n;$(".vendorSkuBox").remove();n=1;$(u).click(function(u){var o,f,e;if(u.preventDefault(),n<r){if(n++,o="",f="",window.sku_sizes.length)for(i=0;i<sku_sizes.length;i++)e="",i==0&&(e="selected"),f+=" <option value='"+sku_sizes[i].attribute_id+"'  "+e+">"+sku_sizes[i].attribute_display_name+"<\/option>";$(t).append('<div class="pb-2  vendorSkuBox form-row"> <div class="form-group col-md-3"><input type="text" class="form-control d-inline required" name="styleVendorSize" id="styleVendorSize" placeholder="Vendor Size" /><\/div> <div class="form-group col-md-3"><select type="text" class="form-control d-inline required" name="styleSize" id="styleSize">'+f+'<\/select><\/div> <div class="form-group col-md-3"><input style="text-transform: uppercase;" type="text"  value="'+o+'" class="form-control d-inline  required" name="styleSku" id="styleSku" placeholder="SKU" /><\/div> <div class="form-group col-md-3"><input type="text" class="form-control d-inline required" name="styleSkuQty" min="1" id="styleSkuQty" placeholder="Qty"  /><\/div> <a href="#" class="remove_field">Remove<\/a> <\/div>')}});$(t).on("click",".remove_field",function(t){$("#po_input_fields_wrap .vendorSkuBox").length==1?alertBox("poAlertMsg","red","Atleast one item is required."):(t.preventDefault(),$(this).parent("div").remove(),n--)});$("#StyleSubType").multiselect({nonSelectedText:"Select sub type",enableFiltering:!0,templates:{li:'<li><a href="javascript:void(0);"><label class="pl-2"><\/label><\/a><\/li>',filter:'<li class="multiselect-item filter"><div class="input-group m-0 mb-1"><input class="form-control multiselect-search" type="text"><\/div><\/li>',filterClearBtn:'<div class="input-group-append"><button class="btn btn btn-primary multiselect-clear-filter" type="button"><i class="fa fa-times"><\/i><\/button><\/div>'},selectedClass:"bg-light",onInitialized:function(n,t){t.find("input[type=checkbox]").addClass("d-none")},onChange:function(n,t){var r=t?"insert":"delete",i;productSubCategoriesAction=productSubCategoriesAction.filter(function(t){return t.product_category_id!=$(n).val()});i={category_id:$(n).val(),action:r};productSubCategoriesAction.push(i);productSubCategoriesAction.length>0&&($("#StyleSubType").removeClass("errorFeild"),$("#StyleSubType").parents(".form-group").find("span.errorMsg").remove())}});$("#tb_StyleNameSuggest").autocomplete({source:function(n,t){n.term.length>=3?$.ajax({url:"/product/autosuggest/"+CurrentVendorId+"/"+n.term,dataType:"json",type:"GET",contentType:"application/json",processData:!1}).always(function(n){console.log(n);n.length>0?(t(n),$("#tb_StyleNameSuggest").removeClass("errorFeild"),$(".errorMsg").remove()):($("#tb_StyleNameSuggest").removeClass("errorFeild"),$(".errorMsg").remove(),$("#tb_StyleNameSuggest").addClass("errorFeild"),$("#tb_StyleNameSuggest").parents(".form-group").append('<span class="errorMsg" style="color:red;font-size: 11px;">Record Not Found<\/span>'),$(".ui-autocomplete").empty().css("border","0"))}):($("#tb_StyleNameSuggest").removeClass("errorFeild"),$("#tb_StyleNameSuggest").parent().find(".errorMsg").remove());n.term.length==0&&($("#tb_StyleNameSuggest").removeClass("errorFeild"),$("#tb_StyleNameSuggest").parent().find(".errorMsg").remove(),$("#tb_StyleNameSuggest").val(""),$("#tb_StyleNameSuggest").attr("data-val",""),$('button[data-poid="'+selectedPurchaseOrderID+'"]').trigger("click"))},select:function(n,t){return SelectedProductID=t.item.value,GetProductDetails(CurrentVendorId,t.item.value,CurrentPOID),$("#tb_StyleNameSuggest").val(t.item.label.split("(")[0]),$("#tb_StyleNameSuggest").attr("data-val",t.item.value),!1},focus:function(n,t){n.preventDefault();$("#tb_StyleNameSuggest").val(t.item.label)}})});$(document).on("blur","#styleSku",function(){var n=new RegExp("^([A-Z]{2})([0-9]{3})([-]{1})([0-9]{1})$"),t=$(this).val().toUpperCase();n.test(t)==!1?$(this).addClass("errorFeild"):$(this).removeClass("errorFeild")});$(document).on("blur focusout","#tb_StyleNameSuggest",function(){$(this).val()==""&&($(this).removeClass("errorFeild"),$("#tb_StyleNameSuggest").parent().find(".errorMsg").remove())});$(document).on("click","#AddItemButton",function(){var i,n,t,h,r,u;if($("#modaladdstylec #ExistingProductSelect").removeAttr("disabled"),$("#modaladdstylec #StyleType").removeAttr("disabled"),$("#modaladdstylec input").val(""),$("#modaladdstylec #StyleSubType option").each(function(){this.innerText!="Choose..."&&this.innerText!="..."&&this.remove()}),$("#StyleSubType").multiselect("clearSelection"),$(".errorMsg").remove(),$("#modaladdstylec input,#modaladdstylec textarea, #modaladdstylec select").val("").removeClass("errorFeild"),$(".vendorSkuBox").remove(),$(".vendorSkuBox_disabled").remove(),$(".style_doc_section").empty(),i=$(this).data("vendorstyle"),$.when(GetCategories(),GetSkuSizes()).done(function(){i!=null&&i!=""&&i!=3}),n=$(this).data("calculationvalues"),n!=""&&n!=null){var f=$(this).data("total_quantity"),e=$(this).data("total_styles"),o=n.filter(function(n){return n.calculation_id==5}),s=n.filter(function(n){return n.calculation_id==6});if(e<=s[0].value){alertBox("poAlertMsg","red"," Total Styles Count reached, Please increase total styles in Purchase Order to proceed.",5e3);return}if(f<=o[0].value){alertBox("poAlertMsg","red"," Total Quantity reached, Please increase total quantity in Purchase Order to proceed.",5e3);return}}CurrentPOID=$(this).data("poid");CurrentVendorId=$(this).data("vendorid");t=$(this).data("proid");h=$(this).data("product_vendor_image");$(".poNumber").text($(this).data("ponumber"));$(".poVendor").text($(this).data("vendorcode"));t==null&&($(this).data("skufamily").length==0?new_sku=$(this).data("vendorcode")+100:(new_sku=$(this).data("skufamily"),r=new_sku.match(/[a-z]+|[^a-z]+/gi),u=r[0]+(parseInt(r[1])+1),new_sku=u));$(".poSkuFamily").text(new_sku);t==null?(SelectedProductID=null,$("#div_styleSuggest").show(),$("#AddNewStyleButton").show(),$("#DeletefromPOButton").hide()):($("#div_styleSuggest").hide(),$("#AddNewStyleButton").hide(),$("#DeletefromPOButton").show());$("#newAddStyleForm #po_id").val(CurrentPOID);$("#newAddStyleForm #vendor_id").val(CurrentVendorId);t?GetProductDetails(CurrentVendorId,t,CurrentPOID):$("#modaladdstylec").modal("show")});$(document).on("change","#StyleType",function(){var n=$(this).val(),r=0,t,i;if(n=="2"?(r=2,$(".vendorSkuArea").show(),$(".add_field_button").hide()):n=="1"?($(".vendorSkuArea").show(),r=window.sku_sizes.length+1,$(".add_field_button").show()):$(".vendorSkuArea").hide(),AppendSkuTextBoxes(r,n),$("#StyleSubType option").remove(),$("#StyleSubType").multiselect("rebuild"),n!=0&&(t=data_Categories.filter(function(t){return t.category_parent_id==n}),t.length)){for(i=0;i<t.length;i++)$("#StyleSubType").append("<option value='"+t[i].category_id+"'>"+t[i].category_name+"<\/option >");$("#StyleSubType").multiselect("rebuild")}});$(document).on("focusout","#po_input_fields_wrap .vendorSkuBox #styleVendorSize",function(){var n=$("#StyleType").val()==2?!0:!1;CreateSKU(this,n)});$(document).on("focusout","#po_input_fields_wrap .vendorSkuBox #styleSku",function(){var n=$(this).val(),t;n!=""&&(isSkuDuplicate(n)?($(this).addClass("errorFeild"),$(this).parents(".form-group").append('<span class="errorMsg" style="color:red;font-size: 11px;">Duplicate SKU entered.<\/span>')):(t=n.split("-")[1],$(this).parent().parent().data("skunum",t),$(this).removeClass("errorFeild"),$(this).parents(".form-group").find(".errorMsg").remove()))});$(document).on("change","#modaladdstylec input,#modaladdstylec select",function(){$(this).removeClass("errorFeild");$(this).parents(".form-group").find(".errorMsg").remove()});$(document).on("keydown","#product_title,#product_color",function(n){return allLetterAllow(n)});$(document).on("keydown","#product_unit_cost,#product_retail",function(n){return onlyNumbersWithDot(n)});$(document).on("keydown","#styleSkuQty",function(n){return onlyNumbers(n)});$(document).on("change","#modaleditstylec #ExistingProductSelect",function(){var n=$(this.options[this.selectedIndex]),t;$(".poAlertMsg").append('<div class="spinner-border text-info"><\/div>');SelectedProductID=n.data("product_id");productImage=n.data("product_vendor_image");SelectedProductTytle=$(this.options[this.selectedIndex]).val();$("#modaleditstylec #product_title").val($(this.options[this.selectedIndex]).attr("data-name"));$("#modaleditstylec #product_unit_cost").val(n.data("product_unit_cost"));$("#modaleditstylec #product_color").val(n.data("product_color"));$("#modaleditstylec #product_retail").val(n.data("product_retail"));t=n.data("po_id");$("#modaleditstylec StyleType option").removeAttr("selected");n.data("product_type")==1?$("#modaleditstylec #StyleType").val($("#modaleditstylec #StyleType option[value=1]").val()).change():$("#modaleditstylec #StyleType").val($("#modaleditstylec #StyleType option[value=2]").val()).change();$(".style_doc_section").empty();productImage!=null?($(".style_doc_section").append("<a onclick='return false' class='documentsLink' data-proid="+SelectedProductID+" data-val="+productImage+">"+productImage+" <span class='podeleteImage'>×<\/span><\/a> <br>"),$(".style_doc_section").removeClass("d-none")):$(".style_doc_section").addClass("d-none");$.ajax({url:"/purchaseorders/lineitems/"+SelectedProductID+"/"+t,type:"GET",contentType:"application/json",processData:!0}).always(function(n){var i=$("#modaleditstylec #po_input_fields_wrap"),t;for($(".vendorSkuBox").remove(),$(".vendorSkuArea").show(),$(".vendorSkuBox_disabled").remove(),t=["XS","S","M","L"],x=0;x<n.length;x++)$(i).append('<div class="pb-2 vendorSkuBox_disabled form-row"> <div class="form-group col-md-3"><input type="text" class="form-control d-inline " name="csize['+x+']" placeholder="Vendor Size"   disabled /><\/div><div class="form-group col-md-3"><input type="text" class="form-control d-inline" name="csku['+x+']" placeholder="SKU" value = "'+t[x]+'"  disabled /><\/div> <div class="form-group col-md-3"><input type="text" class="form-control d-inline " name="size['+x+']" placeholder="Size" value="'+n[x].sku+'" style="text-transform: uppercase;"  disabled /><\/div> <div class="form-group col-md-3"> <input type="text" class="form-control d-inline " name="cqty['+x+']" placeholder="Qty" value="'+n[x].line_item_ordered_quantity+'"  disabled />  ');$(".poAlertMsg").html("")})});$(document).on("click","#EditItemButton",function(){var n=$(this).data("poid");$(".errorMsg").remove();$("#modaleditstylec input,textarea,select").val("").removeClass("errorFeild");var t=$(this).data("vendorid"),r=$(this).data("proid"),u=$(this).data("product_vendor_image");$(".poNumber").text($(this).data("ponumber"));$("#modaleditstylec input").val("");$("#modaleditstylec #StyleSubType option").each(function(){this.innerText!="Choose..."&&this.innerText!="..."&&this.remove()});$("#modaleditstylec").modal("show");$.ajax({url:"/vendor/products/"+t,type:"GET",contentType:"application/json",processData:!0}).always(function(u){var f;for(u=u.vendorProducts,$("#modaleditstylec #ExistingProductSelect option").remove(),$("#modaleditstylec #ExistingProductSelect").append("<option id='-1' value=''>Choose...<\/option>"),f="",$("#po_id").val(n),$("#vendor_id").val(t),$(".vendorSkuBox_disabled").remove(),$(".vendorSkuBox").remove(),i=0;i<u.length;i++)$("#modaleditstylec #ExistingProductSelect").append("<option value='"+u[i].product_id+"' data-product_type='"+u[i].product_type_id+"' data-product_vendor_image='"+u[i].product_vendor_image+"' data-product_color='"+u[i].vendor_color_name+"' data-product_unit_cost='"+u[i].product_cost+"' data-product_retail='"+u[i].product_retail+"' data-Product_id='"+u[i].product_id+"'  data-skufamily='"+u[i].sku_family+"'  data-po_id='"+n+"' data-name='"+u[i].product_name+"' >"+u[i].product_name+"<\/option>"),f=u[i].sku_family;$("#modaleditstylec #ExistingProductSelect").val(r).trigger("change");$("#modaleditstylec #ExistingProductSelect").prop("disabled",!0);var e=f.substring(0,2),o=parseInt(f.substr(2))+1,s=e+o,h=$("#po_input_fields_wrap"),c=["","XS","S","M","L"];for(x=1;x<5;x++)$(h).append('<div class="pb-2  vendorSkuBox form-row"> <div class="form-group col-md-3"><input type="text" class="form-control d-inline required" name="styleVendorSize" id="styleVendorSize" placeholder="Vendor Size" /><\/div> <div class="form-group col-md-3"><input type="text" class="form-control d-inline  required" name="styleSize" id="styleSize" placeholder="Size" value = "'+c[x]+'" /><\/div> <div class="form-group col-md-3"><input type="text"  style="text-transform: uppercase;" class="form-control d-inline  required" name="styleSku" id="styleSku" placeholder="SKU" value = "'+s+"-"+x+'" /><\/div> <div class="form-group col-md-3"><input type="text" class="form-control d-inline  required" name="styleSkuQty" id="styleSkuQty"  min="1" placeholder="Qty" /><\/div> <a href="#" class="remove_field">Remove<\/a> <\/div>');console.log(u)})});$(document).on("change","#modaleditstylec input,#modaleditstylec select",function(){$(this).removeClass("errorFeild");$(this).parents(".form-group").find(".errorMsg").remove()});$(document).ajaxStart(function(){console.log("request started")});$(document).ajaxError(function(n,t){t.responseJSON?alertBox("vendorAlertMsg","red",t.responseJSON.Message):alertBox("vendorAlertMsg","red",t.responseText,5e4)});$(document).ready(function(){$(".loading").hide();$("#openpo").DataTable({aaSorting:[]});$(".datatable_js").DataTable({columnDefs:[{orderable:!1,targets:[0,1,7]},]});general_search()});$(document).on("click","#general_search_btn",function(){$("#general_search").autocomplete("search",$("#general_search").val())});$(document).ready(function(){$(".edit").click(function(){$(this).hide();$(this).prev().hide();$(this).next().show();$(this).next().select()});$('input.edittitlet[type="text"]').blur(function(){$.trim(this.value)==""?this.value=this.defaultValue?this.defaultValue:"":$(this).prev().prev().html(this.value);$(this).hide();$(this).prev().show();$(this).prev().prev().show()});$('input.edittitlet[type="text"]').keypress(function(n){n.keyCode=="13"&&($.trim(this.value)==""?this.value=this.defaultValue?this.defaultValue:"":$(this).prev().prev().html(this.value),$(this).hide(),$(this).prev().show(),$(this).prev().prev().show())})});$("#vendor").multiselect({nonSelectedText:"Select Vendor",enableFiltering:!0,templates:{li:'<li><a href="javascript:void(0);"><label class="pl-2"><\/label><\/a><\/li>',filter:'<li class="multiselect-item filter"><div class="input-group m-0 mb-1"><input class="form-control multiselect-search" type="text"><\/div><\/li>',filterClearBtn:'<div class="input-group-append"><button class="btn btn btn-primary multiselect-clear-filter" type="button"><i class="fa fa-times"><\/i><\/button><\/div>'},selectedClass:"bg-light",onInitialized:function(n,t){t.find("input[type=checkbox]").addClass("d-none")}});$("#size").multiselect({nonSelectedText:"Select Size",enableFiltering:!0,templates:{li:'<li><a href="javascript:void(0);"><label class="pl-2"><\/label><\/a><\/li>',filter:'<li class="multiselect-item filter"><div class="input-group m-0 mb-1"><input class="form-control multiselect-search" type="text"><\/div><\/li>',filterClearBtn:'<div class="input-group-append"><button class="btn btn btn-primary multiselect-clear-filter" type="button"><i class="fa fa-times"><\/i><\/button><\/div>'},selectedClass:"bg-light",onInitialized:function(n,t){t.find("input[type=checkbox]").addClass("d-none")}});$("#status,#size").multiselect({nonSelectedText:"Select Status",enableFiltering:!0,templates:{li:'<li><a href="javascript:void(0);"><label class="pl-2"><\/label><\/a><\/li>',filter:'<li class="multiselect-item filter"><div class="input-group m-0 mb-1"><input class="form-control multiselect-search" type="text"><\/div><\/li>',filterClearBtn:'<div class="input-group-append"><button class="btn btn btn-primary multiselect-clear-filter" type="button"><i class="fa fa-times"><\/i><\/button><\/div>'},selectedClass:"bg-light",onInitialized:function(n,t){t.find("input[type=checkbox]").addClass("d-none")}});